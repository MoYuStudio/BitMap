# BitMap 像素地图

[![Version](https://img.shields.io/badge/version-3.0.0-blue.svg)](https://github.com/your-username/BitMap)
[![Godot](https://img.shields.io/badge/Godot-4.4-green.svg)](https://godotengine.org/)
[![License](https://img.shields.io/badge/license-MIT-yellow.svg)](LICENSE)

一个基于 Godot 4.4 开发的像素风格地图编辑器，支持地形生成、城市建造和铁路系统。

**版本**: v3.0.0
**更新时间**: 2025年9月: 活跃开发中

## 🎮 项目特色

- **8级高度图系统**: 使用多层噪声算法生成包含深海、深水、浅水、海岸、平原、丘陵、山地、高山等8种地形的像素地图
- **智能地形生成**: 支持平滑度噪声控制，不同区域有平缓的平原和剧烈变化的山地
- **海岸类型变化**: 海岸区域包含崖壁和沙滩两种类型，增加地形真实感
- **城市建造系统**: 支持在任意位置放置具有中国古典风格名称的城市
- **道路网络**: 可以绘制连接城市之间的铁路、高速公路和公路线路
- **多种建造模式**: 提供绘制模式和道路模式两种不同的建造方式
- **实时预览**: 道路绘制时提供实时预览功能
- **大尺寸地图**: 支持256x256像素的大地图，提供更广阔的建造空间

## 📸 游戏截图

![BitMap游戏界面 v1.0.0](https://github.com/MoYuStudio/BitMap/blob/main/doc/v1.png)

*📅 **截图时间**: 2025年9月*
*🏷️ **版本**: v1.0.0*
*🎮 **功能展示**: 游戏主界面展示了像素风格的地图编辑器，包含地形生成、城市建造和铁路网络系统。界面左上角是建筑选择器，支持多种建造模式。地图上可以看到多个中国古典风格的城市（如会稽、金陵、武威等）通过铁路网络相互连接。*

![BitMap游戏界面 v2.0.0](https://github.com/MoYuStudio/BitMap/blob/main/doc/v2.png)

*📅 **截图时间**: 2025年9月*
*🏷️ **版本**: v2.0.0*
*🎮 **功能展示**: 最新版本展示了改进的地形生成系统，包含8级高度图（深海、深水、浅水、海岸、平原、丘陵、山地、高山）。地图尺寸扩展到256x256，提供更广阔的建造空间。城市网络更加密集，包含多个中国古典风格的城市，通过复杂的铁路网络相互连接。*

![BitMap游戏界面 v3.0.0](https://github.com/MoYuStudio/BitMap/blob/main/doc/v3.png)

*📅 **截图时间**:2025年9月*
*🏷️ **版本**: v3.0.0*
*🎮 **功能展示**: 最新版本展示了更加完善的道路网络系统，包含铁路（黑白虚线）和高速公路（黄色和浅绿色实线）两种道路类型。地图上分布着多个中国古典风格的城市，通过复杂的多类型道路网络相互连接。界面左上角的建筑选择器支持铁路、高速、公路三种建造类型，以及绘制模式和道路模式两种建造方式。*

## 🚀 快速开始

### 环境要求

- Godot 4.4 或更高版本
- 支持 GL Compatibility 渲染器

### 运行项目

1. 克隆或下载项目到本地
2. 使用 Godot 4.4 打开 `project/project.godot` 文件
3. 点击运行按钮或按 F5 启动项目

## 🎯 操作指南

### 基础操作

- **生成地形**: 按 `1` 键生成新的随机地形地图
- **游戏控制**:
  - `ESC` 键：返回主菜单
  - `P` 键：暂停/继续游戏
- **鼠标控制**:
  - 左键：放置城市或绘制道路
  - 右键：移除城市或删除道路
  - 滚轮：缩放地图
  - 拖拽：移动视角

### 建造模式

#### 绘制模式

- 按住鼠标左键拖拽连续放置城市
- 按住鼠标右键拖拽连续移除城市
- 适合快速大面积建造

#### 道路模式

- 左键点击开始绘制道路（铁路、高速公路或公路）
- 继续左键点击添加中间点
- 再次左键点击城市或空白处结束绘制
- 右键取消当前道路绘制
- 按住右键拖拽可以连续删除多条道路
- 可以在铁路、高速公路和公路之间切换

### 地形系统

项目支持以下8级高度图地形类型：

- **深海** (Deep Ocean): 海洋最深处
- **深水** (Deep Water): 海洋深处
- **浅水** (Shallow Water): 海岸线附近
- **海岸** (Coast): 陆地和海洋的过渡区域
- **平原** (Plains): 主要陆地类型，适合建造
- **丘陵** (Hills): 中等高度的地形
- **山地** (Mountains): 高海拔山地地形
- **高山** (High Mountains): 最高海拔地区

### 城市系统

- 城市使用中国古典风格名称（如：当涂、江州、婺州、普陀、蓬莱、谯郡、陈留、许昌、鄱阳、池州、桐庐、天台、建德、龙泉、安庆、天水、范阳、临安、建业、旬门、淳安、合肥、上虞、六合、临海等）
- 每个城市都有唯一名称，避免重复
- 支持点击城市进行交互
- 城市可以连接到道路网络（铁路、高速公路和公路）

## 🏗️ 项目结构

```
project/
├── assets/                    # 资源文件
│   ├── tile/                 # 地形瓦片纹理
│   ├── city.png             # 城市图标
│   ├── cursor.png           # 自定义光标
│   ├── railway.png          # 铁路纹理
│   └── tile_set.tres        # 瓦片集配置
├── src/
│   ├── main.tscn            # 主场景
│   └── module/              # 功能模块
│       ├── terrain_layer.gd     # 地形层管理
│       ├── city_layer.gd        # 城市层管理
│       ├── road_layer.gd        # 道路层管理
│       ├── cursor_controller.gd # 光标控制器
│       ├── building_selector.gd # 建造选择器
│       ├── camera_2d.gd         # 相机控制
│       ├── city_instance.gd     # 城市实例
│       └── city.tscn           # 城市场景
└── project.godot            # 项目配置
```

## 🔧 技术实现

### 地形生成算法

使用 `FastNoiseLite` 生成 Perlin 噪声，根据噪声值分布生成不同地形：

- 噪声值范围：-1 到 1
- 可配置的陆地/海洋比例
- 可配置的地形类型分布比例
- 动态计算地形阈值

### 坐标系统

- 使用 Godot 的 TileMapLayer 坐标系统
- 支持世界坐标与瓦片坐标的转换
- 地图以原点为中心生成

### 道路系统

- 使用 Line2D 节点绘制道路（铁路、高速公路和公路）
- 支持纹理贴图和纯色显示
- 实时预览功能
- 可连接城市或自由绘制
- 支持铁路、高速公路和公路三种类型

## 🎨 自定义配置

### 地形参数调整

在 `terrain_layer.gd` 中可以调整以下参数：

```gdscript
# 陆地海洋比例 (0.0 = 全海洋, 1.0 = 全陆地)
var land_ratio = 0.45

# 地形分布比例
var ocean_deep_ratio = 0.8    # 深水占海洋的比例
var ocean_shallow_ratio = 0.2 # 浅水占海洋的比例
var land_grass_ratio = 0.6    # 草地占陆地的比例
var land_stone_ratio = 0.3    # 石头占陆地的比例
var land_snow_ratio = 0.1     # 雪地占陆地的比例
```

### 地图尺寸

```gdscript
const MAP_WIDTH = 256   # 地图宽度
const MAP_HEIGHT = 256  # 地图高度
```

## 🎯 未来计划

- [ ] 添加更多建筑类型
- [ ] 实现城市发展和升级系统
- [ ] 添加资源管理系统
- [ ] 支持地图保存和加载
- [ ] 添加更多地形类型
- [ ] 实现多人协作编辑

## 📝 开发说明

### 添加新地形类型

1. 在 `assets/tile/` 目录添加新纹理
2. 在 `tile_set.tres` 中配置新瓦片
3. 在 `terrain_layer.gd` 的 `TERRAIN_TILE_TYPES` 中添加映射
4. 更新地形生成逻辑

### 添加新建筑类型

1. 创建建筑场景文件
2. 在 `building_selector.gd` 中添加新按钮
3. 在相应的层管理器中添加放置逻辑
4. 更新光标控制器处理新建筑类型

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个项目！

## 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 📝 更新日志

### v3.0.0 (2024年12月)

- 🛣️ **道路系统完善**: 新增公路类型，现在支持铁路、高速、公路三种道路类型
- 🎨 **道路视觉优化**: 铁路使用黑白虚线显示，高速公路使用黄色和浅绿色实线显示
- 🏙️ **城市网络扩展**: 新增更多中国古典风格城市，包括当涂、江州、婺州、普陀、蓬莱、谯郡、陈留、许昌、鄱阳、池州、桐庐、天台、建德、龙泉、安庆、天水、范阳、临安、建业、旬门、淳安、合肥、上虞、六合、临海等
- 🎮 **建造模式优化**: 建筑选择器界面更加清晰，支持三种建造类型和两种建造模式
- 🗺️ **地图布局改进**: 优化了城市和道路的分布，形成更加合理的交通网络
- 🎯 **用户体验提升**: 改进了道路绘制和城市放置的用户交互体验

### v2.0.0 (2024年12月)

- 🗺️ **8级高度图系统**: 实现深海、深水、浅水、海岸、平原、丘陵、山地、高山等8种地形
- 🎯 **智能地形生成**: 添加平滑度噪声控制，支持平缓平原和剧烈山地
- 🏖️ **海岸类型变化**: 海岸区域支持崖壁和沙滩两种类型
- 📏 **地图尺寸升级**: 从128x128扩展到256x256，提供更广阔的建造空间
- 🎨 **地形优化**: 优化地形分布比例，减少海岸区域到1-2%
- 🔧 **噪声算法改进**: 使用多层噪声算法，包括大陆、山脉、丘陵、细节、山脊、海洋、海岸、平滑度、海岸类型等9种噪声
- 🎮 **地形参数调整**: 支持动态调整海洋/陆地比例和地形平滑度
- 🚂 **道路系统升级**: 新增高速公路支持，将铁路层升级为道路层
- 🛣️ **道路类型切换**: 支持在铁路和高速公路之间切换
- 🎨 **UI优化**: 根据模式显示不同的建筑类型选项，所有按钮都添加了图标

### v1.0.0 (2024年12月)

- ✨ **初始版本发布**
- 🎮 实现程序化地形生成系统
- 🏙️ 添加城市建造和管理功能
- 🚂 实现道路网络绘制系统（铁路和高速公路）
- 🎯 支持两种建造模式（绘制、道路）
- 🎨 添加中国古典风格城市名称库
- 🖱️ 实现自定义光标和实时预览
- 📱 完整的用户界面和操作指南

### 计划中的功能

- 🔄 地图保存和加载系统
- 🏗️ 更多建筑类型和装饰
- 📊 城市发展和资源管理
- 🌐 多人协作编辑功能
- 🎵 音效和背景音乐
- 📱 移动端适配

---

**享受建造你的像素世界吧！** 🎮✨
